<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neutryx‑Core — Interactive Pricer Demo</title>
  <style>
    :root{
      --ink:#0a0a0b; --muted:#666; --bg:#f6f7fb; --card:#fff;
      --brand:#0a66c2; --acc:#5b9cff; --ring:rgba(10,102,194,.25);
      --ok:#0ea75a; --warn:#f5b100; --err:#d93025; --border:#e4e6ef;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:var(--bg)}
    header{position:sticky;top:0;z-index:50;background:#fff;padding:12px 16px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .wrap{max-width:1080px;margin:0 auto;display:flex;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .brand img{width:36px;height:36px;object-fit:contain}
    .brand span{font-weight:800;letter-spacing:.2px}
    nav{margin-left:auto;display:flex;gap:14px;flex-wrap:wrap}
    nav a{color:var(--brand);text-decoration:none;font-size:.95rem}
    nav a:hover{text-decoration:underline}
    @media (max-width:768px){
      .wrap{flex-direction:column;align-items:flex-start;gap:12px}
      nav{margin-left:0;width:100%;justify-content:flex-start;gap:12px}
      .brand span{font-size:.95rem}
    }
    main{max-width:1080px;margin:0 auto;padding:24px 16px 64px}
    h1{margin:.3rem 0 .6rem;font-size:2rem}
    p{color:#444;line-height:1.7}
    @media (max-width:640px){
      main{padding:16px 12px 48px}
      h1{font-size:1.6rem}
      p{font-size:.95rem}
      .toolbar{font-size:.9rem}
    }
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);text-decoration:none;color:var(--brand);background:#fff}
    .btn:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .note,.box{background:#fff;border-left:4px solid var(--brand);padding:12px 14px;border-radius:12px;box-shadow:0 1px 6px rgba(0,0,0,.05)}
    @media (max-width:640px){
      .note,.box{padding:10px 12px;font-size:.95rem}
    }
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    @media (max-width:900px){
      .grid > .card{grid-column:span 12!important}
    }
    @media (max-width:640px){
      .grid{gap:12px}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.04)}
    .card h3{margin:0 0 8px;font-size:1rem}
    .card .section{padding:16px;border-top:1px solid var(--border)}
    .card .section:first-child{border-top:0;border-top-left-radius:16px;border-top-right-radius:16px}
    .card .section:last-child{border-bottom-left-radius:16px;border-bottom-right-radius:16px}
    @media (max-width:640px){
      .card{border-radius:12px}
      .card .section{padding:12px}
      .card h3{font-size:.95rem}
    }
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:.9rem;color:#333}
    .row{display:grid;grid-template-columns:repeat(6,1fr);gap:12px}
    @media (max-width:768px){
      .row{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:480px){
      .row{grid-template-columns:1fr}
    }
    input,select{appearance:none;width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;outline:none}
    input:focus,select:focus{border-color:var(--acc);box-shadow:0 0 0 4px var(--ring)}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .primary{background:var(--brand);color:#fff;border-color:transparent}
    .primary:hover{filter:brightness(.98)}
    .ghost{background:#fff;color:var(--ink)}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background:#eef2ff;border:1px solid #d4dbff;color:#223;display:inline-block;padding:2px 6px;border-radius:6px}
    .status{display:inline-flex;align-items:center;gap:8px;font-size:.9rem}
    .dot{width:9px;height:9px;border-radius:50%}
    .ok{background:var(--ok)} .warn{background:var(--warn)} .err{background:var(--err)} .muted{background:#bbb}
    .mutetext{color:#666}
    pre{margin:0;background:#0b1020;color:#d7e0ff;border-radius:12px;padding:14px;overflow:auto;border:1px solid #0f1630;max-width:100%;word-wrap:break-word;white-space:pre-wrap}
    code{font-family:ui-monospace,Consolas,Menlo,monospace;font-size:.92rem}
    @media (max-width:640px){
      pre{padding:12px;font-size:.85rem}
      code{font-size:.85rem}
    }
    .small{font-size:.9rem;color:#555}
    @media (max-width:640px){
      .small{font-size:.85rem;line-height:1.6}
    }
    footer{text-align:center;color:#777;padding:28px 16px 44px}
    @media (max-width:640px){
      footer{padding:20px 12px 32px;font-size:.9rem}
    }
    .pill{padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:.8rem;color:#333}
    /* Validation styles */
    .field-error input,.field-error select{border-color:var(--err);background:#fef2f2}
    .error-msg{color:var(--err);font-size:.85rem;margin-top:4px;display:none}
    .field-error .error-msg{display:block}
    /* Loading spinner */
    .spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* Copy button */
    .copy-btn{position:absolute;top:10px;right:10px;padding:4px 8px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:6px;color:#d7e0ff;font-size:.75rem;cursor:pointer;transition:all .2s}
    .copy-btn:hover{background:rgba(255,255,255,.2)}
    .copy-btn.copied{background:var(--ok);color:#fff;border-color:var(--ok)}
    .code-wrapper{position:relative}
    /* Disabled state */
    button:disabled,input:disabled,select:disabled{opacity:.6;cursor:not-allowed}
    /* Fade animation */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .fade-in{animation:fadeIn .3s ease-in}
    /* Tabs */
    .tabs{display:flex;gap:8px;border-bottom:2px solid var(--border);margin-bottom:16px}
    .tab{padding:10px 16px;border:none;background:transparent;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s;font-size:.95rem;font-weight:500}
    .tab:hover{color:var(--brand);background:rgba(10,102,194,.05)}
    .tab.active{color:var(--brand);border-bottom-color:var(--brand)}
    .tab-content{display:none}
    .tab-content.active{display:block;animation:fadeIn .3s ease-in}
    @media (max-width:640px){
      .tabs{overflow-x:auto;flex-wrap:nowrap}
      .tab{white-space:nowrap;font-size:.9rem;padding:8px 12px}
    }
    /* Section headers */
    .section-header{font-size:.95rem;font-weight:600;color:var(--brand);margin-bottom:12px;padding-bottom:6px;border-bottom:2px solid var(--border)}
    /* Two-column layout for PV/Risk */
    .two-col-layout{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media (max-width:900px){
      .two-col-layout{grid-template-columns:1fr;gap:16px}
    }
    .col-section{background:rgba(10,102,194,.02);padding:14px;border-radius:12px;border:1px solid rgba(10,102,194,.1)}
    @media (max-width:640px){
      .col-section{padding:12px}
    }
    /* Three-column layout for XVA */
    .three-col-layout{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    @media (max-width:1200px){
      .three-col-layout{grid-template-columns:1fr 1fr;gap:14px}
    }
    @media (max-width:768px){
      .three-col-layout{grid-template-columns:1fr;gap:14px}
    }
    /* Percentage input styling */
    .pct-input{position:relative}
    .pct-input input{padding-right:30px}
    .pct-symbol{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(--muted);pointer-events:none}
    /* Mobile-friendly input fields */
    @media (max-width:640px){
      input,select{font-size:16px;padding:12px}
      .btn{padding:12px 16px;font-size:1rem}
      .section-header{font-size:.9rem}
      label{font-size:.88rem}
    }
    /* Curve grid responsive */
    @media (max-width:640px){
      .row[style*="grid-template-columns:repeat(3,1fr)"]{grid-template-columns:repeat(2,1fr)!important}
    }
    @media (max-width:400px){
      .row[style*="grid-template-columns:repeat(3,1fr)"]{grid-template-columns:1fr!important}
      .row[style*="grid-template-columns:repeat(2,1fr)"]{grid-template-columns:1fr!important}
    }
    /* API config row */
    .api-config-row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end}
    @media (max-width:640px){
      .api-config-row{grid-template-columns:1fr;gap:8px}
      .desktop-only{display:none}
    }
    /* Action buttons responsive */
    @media (max-width:640px){
      .actions,.actions .row{grid-template-columns:1fr;gap:8px}
      .actions .field label{display:none}
    }
    /* Results metadata row */
    .results-meta-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:640px){
      .results-meta-row{grid-template-columns:1fr;gap:10px}
    }
    /* Action buttons */
    .action-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    @media (max-width:640px){
      .action-buttons{grid-template-columns:1fr}
    }
    /* Results header */
    .results-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
    .results-header h3{margin:0}
    @media (max-width:400px){
      .results-header{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <a class="brand" href="index.html" aria-label="Back to Home">
        <img src="assets/logo.png" alt="Neutryx logo">
        <span>Neutryx Lab</span>
      </a>
      <nav>
        <a href="core.html" aria-current="page">Neutryx‑Core</a>
        <a href="ai.html">Neutryx‑AI</a>
        <a href="https://github.com/neutryx-lab" target="_blank" rel="noreferrer noopener">GitHub</a>
        <a href="mailto:contact@neutryx.tech">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <h1>Neutryx‑Core (Open‑Source)</h1>
    <p>High‑performance numerical engine for pricing/risk/XVA, built on JAX and automatic differentiation.</p>
    <p class="toolbar">
      <a class="btn" href="https://github.com/neutryx-lab/neutryx-core" target="_blank" rel="noreferrer noopener">GitHub Repository →</a>
      <a class="btn" href="https://github.com/neutryx-lab" target="_blank" rel="noreferrer noopener">Organization →</a>
      <span class="pill">Demo: Public API</span>
    </p>

    <section class="note" style="margin:18px 0 22px">
      <strong>License:</strong> Permissive open‑source (e.g., MIT/BSD). No confidential learning logic is included here.
    </section>

    <!-- API URL Configuration -->
    <section class="card" style="margin-bottom:20px">
      <div class="section">
        <div class="api-config-row">
          <div class="field">
            <label for="api-url">API Base URL</label>
            <input id="api-url" type="text" value="https://neutryx-api.onrender.com" placeholder="https://neutryx-api.onrender.com" />
          </div>
          <div class="field">
            <label class="desktop-only">&nbsp;</label>
            <button id="btnTest" class="btn ghost" type="button">Test Connection</button>
          </div>
        </div>
      </div>
    </section>

    <!-- DEMO GRID -->
    <section class="grid" style="grid-template-columns:repeat(12,1fr);gap:18px">
      <!-- Left: Inputs -->
      <div class="card" style="grid-column:span 7">
        <div class="section">
          <h3>Demo Inputs</h3>
          <div class="small mutetext">Switch between PV, Risk, and XVA calculations using the tabs below.</div>
        </div>

        <div class="section">
          <!-- Tabs -->
          <div class="tabs">
            <button class="tab active" data-tab="pv">PV</button>
            <button class="tab" data-tab="risk">Risk</button>
            <button class="tab" data-tab="xva">XVA</button>
          </div>

          <!-- PV Tab Content (Swap Price) -->
          <div class="tab-content active" id="pv-content">
            <div class="two-col-layout">
              <!-- Left column: Swap Details -->
              <div class="col-section">
                <div class="section-header">Swap Details</div>
                <div class="field" id="field-pv-type" style="margin-bottom:12px">
                  <label for="pv-type">Type</label>
                  <select id="pv-type">
                    <option value="true">Pay Fixed</option>
                    <option value="false">Receive Fixed</option>
                  </select>
                </div>
                <div class="field" id="field-pv-notional" style="margin-bottom:12px">
                  <label for="pv-notional">Notional (USD)</label>
                  <input id="pv-notional" type="text" value="10,000,000" />
                  <div class="error-msg"></div>
                </div>
                <div class="field pct-input" id="field-pv-fixed-rate" style="margin-bottom:12px">
                  <label for="pv-fixed-rate">Fixed Rate</label>
                  <input id="pv-fixed-rate" type="number" value="2.4" step="0.1" />
                  <span class="pct-symbol">%</span>
                  <div class="error-msg"></div>
                </div>
                <div class="field" id="field-pv-pay-freq" style="margin-bottom:12px">
                  <label for="pv-pay-freq">Pay Freq (months)</label>
                  <select id="pv-pay-freq">
                    <option value="6">6 (Semi-annual)</option>
                    <option value="12">12 (Annual)</option>
                    <option value="3">3 (Quarterly)</option>
                  </select>
                </div>
                <div class="field" id="field-pv-maturity" style="margin-bottom:12px">
                  <label for="pv-maturity">Maturity (years)</label>
                  <input id="pv-maturity" type="number" value="5" step="0.5" min="0.5" />
                  <div class="error-msg"></div>
                </div>
              </div>

              <!-- Right column: Zero Rate Curve -->
              <div class="col-section">
                <div class="section-header">Zero Rate Curve</div>
                <div class="row" style="grid-template-columns:repeat(3,1fr)">
                  <div class="field pct-input" id="field-pv-curve-1m" style="margin-bottom:12px">
                    <label for="pv-curve-1m">1M</label>
                    <input id="pv-curve-1m" type="number" value="0.5" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-pv-curve-3m" style="margin-bottom:12px">
                    <label for="pv-curve-3m">3M</label>
                    <input id="pv-curve-3m" type="number" value="0.7" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-pv-curve-6m" style="margin-bottom:12px">
                    <label for="pv-curve-6m">6M</label>
                    <input id="pv-curve-6m" type="number" value="0.9" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-pv-curve-1y" style="margin-bottom:12px">
                    <label for="pv-curve-1y">1Y</label>
                    <input id="pv-curve-1y" type="number" value="1.1" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-pv-curve-2y" style="margin-bottom:12px">
                    <label for="pv-curve-2y">2Y</label>
                    <input id="pv-curve-2y" type="number" value="1.5" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-pv-curve-5y" style="margin-bottom:12px">
                    <label for="pv-curve-5y">5Y</label>
                    <input id="pv-curve-5y" type="number" value="2.2" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Risk Tab Content (Swap Risks) -->
          <div class="tab-content" id="risk-content">
            <div class="two-col-layout">
              <!-- Left column: Swap Details -->
              <div class="col-section">
                <div class="section-header">Swap Details</div>
                <div class="field" id="field-risk-type" style="margin-bottom:12px">
                  <label for="risk-type">Type</label>
                  <select id="risk-type">
                    <option value="true">Pay Fixed</option>
                    <option value="false">Receive Fixed</option>
                  </select>
                </div>
                <div class="field" id="field-risk-notional" style="margin-bottom:12px">
                  <label for="risk-notional">Notional (USD)</label>
                  <input id="risk-notional" type="text" value="10,000,000" />
                  <div class="error-msg"></div>
                </div>
                <div class="field pct-input" id="field-risk-fixed-rate" style="margin-bottom:12px">
                  <label for="risk-fixed-rate">Fixed Rate</label>
                  <input id="risk-fixed-rate" type="number" value="2.4" step="0.1" />
                  <span class="pct-symbol">%</span>
                  <div class="error-msg"></div>
                </div>
                <div class="field" id="field-risk-pay-freq" style="margin-bottom:12px">
                  <label for="risk-pay-freq">Pay Freq (months)</label>
                  <select id="risk-pay-freq">
                    <option value="6">6 (Semi-annual)</option>
                    <option value="12">12 (Annual)</option>
                    <option value="3">3 (Quarterly)</option>
                  </select>
                </div>
                <div class="field" id="field-risk-maturity" style="margin-bottom:12px">
                  <label for="risk-maturity">Maturity (years)</label>
                  <input id="risk-maturity" type="number" value="5" step="0.5" min="0.5" />
                  <div class="error-msg"></div>
                </div>
                <div class="field" id="field-risk-bump-bp" style="margin-bottom:12px">
                  <label for="risk-bump-bp">Bump (bps)</label>
                  <input id="risk-bump-bp" type="number" value="1.0" step="0.1" />
                  <div class="error-msg"></div>
                </div>
              </div>

              <!-- Right column: Zero Rate Curve -->
              <div class="col-section">
                <div class="section-header">Zero Rate Curve</div>
                <div class="row" style="grid-template-columns:repeat(3,1fr)">
                  <div class="field pct-input" id="field-risk-curve-1m" style="margin-bottom:12px">
                    <label for="risk-curve-1m">1M</label>
                    <input id="risk-curve-1m" type="number" value="0.5" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-risk-curve-3m" style="margin-bottom:12px">
                    <label for="risk-curve-3m">3M</label>
                    <input id="risk-curve-3m" type="number" value="0.7" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-risk-curve-6m" style="margin-bottom:12px">
                    <label for="risk-curve-6m">6M</label>
                    <input id="risk-curve-6m" type="number" value="0.9" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-risk-curve-1y" style="margin-bottom:12px">
                    <label for="risk-curve-1y">1Y</label>
                    <input id="risk-curve-1y" type="number" value="1.1" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-risk-curve-2y" style="margin-bottom:12px">
                    <label for="risk-curve-2y">2Y</label>
                    <input id="risk-curve-2y" type="number" value="1.5" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" id="field-risk-curve-5y" style="margin-bottom:12px">
                    <label for="risk-curve-5y">5Y</label>
                    <input id="risk-curve-5y" type="number" value="2.2" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- XVA Tab Content -->
          <div class="tab-content" id="xva-content">
            <div class="three-col-layout">
              <!-- Left column: Swap Details -->
              <div class="col-section">
                <div class="section-header">Swap Details</div>
                <div class="field" id="field-xva-type" style="margin-bottom:12px">
                  <label for="xva-type">Type</label>
                  <select id="xva-type">
                    <option value="true">Pay Fixed</option>
                    <option value="false">Receive Fixed</option>
                  </select>
                </div>
                <div class="field" id="field-xva-notional" style="margin-bottom:12px">
                  <label for="xva-notional">Notional (USD)</label>
                  <input id="xva-notional" type="text" value="10,000,000" />
                  <div class="error-msg"></div>
                </div>
                <div class="field pct-input" id="field-xva-fixed-rate" style="margin-bottom:12px">
                  <label for="xva-fixed-rate">Fixed Rate</label>
                  <input id="xva-fixed-rate" type="number" value="2.4" step="0.1" />
                  <span class="pct-symbol">%</span>
                  <div class="error-msg"></div>
                </div>
                <div class="field" id="field-xva-pay-freq" style="margin-bottom:12px">
                  <label for="xva-pay-freq">Pay Freq (months)</label>
                  <select id="xva-pay-freq">
                    <option value="6">6 (Semi-annual)</option>
                    <option value="12">12 (Annual)</option>
                    <option value="3">3 (Quarterly)</option>
                  </select>
                </div>
                <div class="field" id="field-xva-maturity" style="margin-bottom:12px">
                  <label for="xva-maturity">Maturity (years)</label>
                  <input id="xva-maturity" type="number" value="6" step="0.5" min="0.5" />
                  <div class="error-msg"></div>
                </div>
              </div>

              <!-- Middle column: Curve + XVA Parameters -->
              <div class="col-section">
                <div class="section-header">Zero Rate Curve</div>
                <div class="row" style="grid-template-columns:repeat(2,1fr);margin-bottom:16px">
                  <div class="field pct-input" style="margin-bottom:12px">
                    <label for="xva-curve-1m">1M</label>
                    <input id="xva-curve-1m" type="number" value="0.5" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" style="margin-bottom:12px">
                    <label for="xva-curve-1y">1Y</label>
                    <input id="xva-curve-1y" type="number" value="1.1" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" style="margin-bottom:12px">
                    <label for="xva-curve-5y">5Y</label>
                    <input id="xva-curve-5y" type="number" value="2.2" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                  <div class="field pct-input" style="margin-bottom:12px">
                    <label for="xva-curve-10y">10Y</label>
                    <input id="xva-curve-10y" type="number" value="2.6" step="0.1" />
                    <span class="pct-symbol">%</span>
                  </div>
                </div>
                <div class="section-header" style="margin-top:8px">XVA Parameters</div>
                <div class="row" style="grid-template-columns:repeat(2,1fr)">
                  <div class="field pct-input" id="field-xva-lgd-cp" style="margin-bottom:12px">
                    <label for="xva-lgd-cp">LGD CP</label>
                    <input id="xva-lgd-cp" type="number" value="60" step="5" />
                    <span class="pct-symbol">%</span>
                    <div class="error-msg"></div>
                  </div>
                  <div class="field pct-input" id="field-xva-lgd-own" style="margin-bottom:12px">
                    <label for="xva-lgd-own">LGD Own</label>
                    <input id="xva-lgd-own" type="number" value="60" step="5" />
                    <span class="pct-symbol">%</span>
                    <div class="error-msg"></div>
                  </div>
                  <div class="field pct-input" id="field-xva-funding" style="margin-bottom:12px">
                    <label for="xva-funding">Funding Spread</label>
                    <input id="xva-funding" type="number" value="0.2" step="0.1" />
                    <span class="pct-symbol">%</span>
                    <div class="error-msg"></div>
                  </div>
                  <div class="field pct-input" id="field-xva-coc" style="margin-bottom:12px">
                    <label for="xva-coc">Cost of Capital</label>
                    <input id="xva-coc" type="number" value="10" step="1" />
                    <span class="pct-symbol">%</span>
                    <div class="error-msg"></div>
                  </div>
                  <div class="field pct-input" id="field-xva-cap-factor" style="margin-bottom:12px">
                    <label for="xva-cap-factor">Capital Factor</label>
                    <input id="xva-cap-factor" type="number" value="50" step="5" />
                    <span class="pct-symbol">%</span>
                    <div class="error-msg"></div>
                  </div>
                  <div class="field" id="field-xva-grid" style="margin-bottom:12px">
                    <label for="xva-grid">Grid (months)</label>
                    <input id="xva-grid" type="number" value="1" step="1" min="1" />
                    <div class="error-msg"></div>
                  </div>
                </div>
              </div>

              <!-- Right column: Hazard Curves -->
              <div class="col-section">
                <div class="section-header">Hazard Curves</div>
                <div style="margin-bottom:14px">
                  <div class="small mutetext" style="margin-bottom:8px">Counterparty:</div>
                  <div class="row" style="grid-template-columns:repeat(3,1fr)">
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-cp-1y">1Y</label>
                      <input id="xva-haz-cp-1y" type="number" value="1.0" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-cp-5y">5Y</label>
                      <input id="xva-haz-cp-5y" type="number" value="1.2" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-cp-10y">10Y</label>
                      <input id="xva-haz-cp-10y" type="number" value="1.5" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                  </div>
                </div>
                <div>
                  <div class="small mutetext" style="margin-bottom:8px">Own:</div>
                  <div class="row" style="grid-template-columns:repeat(3,1fr)">
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-own-1y">1Y</label>
                      <input id="xva-haz-own-1y" type="number" value="0.8" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-own-5y">5Y</label>
                      <input id="xva-haz-own-5y" type="number" value="1.0" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                    <div class="field pct-input" style="margin-bottom:12px">
                      <label for="xva-haz-own-10y">10Y</label>
                      <input id="xva-haz-own-10y" type="number" value="1.2" step="0.1" />
                      <span class="pct-symbol">%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Engine Toggles (common) -->
          <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border)">
            <div class="small mutetext" style="margin-bottom:8px">Engine Configuration:</div>
            <div class="row" style="grid-template-columns:repeat(3,1fr)">
              <div class="field">
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                  <input id="use-jax" type="checkbox" checked />
                  <span>Use JAX</span>
                </label>
              </div>
              <div class="field">
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                  <input id="use-jit" type="checkbox" checked />
                  <span>Use JIT</span>
                </label>
              </div>
              <div class="field">
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                  <input id="use-aad" type="checkbox" checked />
                  <span>Use AAD</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Action Buttons (common) -->
          <div class="action-buttons">
            <button id="btnRun" class="btn primary" type="button">Run computation</button>
            <button id="btnSample" class="btn ghost" type="button">Sample params</button>
          </div>
        </div>

        <div class="section small mutetext">
          <strong>API Endpoints:</strong><br>
          • PV: <code>/swap/price</code> — Swap pricing with fair rate calculation<br>
          • Risk: <code>/swap/risks</code> — DV01 and bucketed sensitivities<br>
          • XVA: <code>/swap/xva</code> — CVA, DVA, FVA, and KVA calculations<br>
          <br>
          <strong>Tips:</strong> Use <span class="kbd">Ctrl+Enter</span> to run, <span class="kbd">Esc</span> to clear errors. Toggle JAX/JIT/AAD to compare performance.
        </div>
      </div>

      <!-- Right: Results -->
      <div class="card" style="grid-column:span 5">
        <div class="section results-header">
          <h3>Results</h3>
          <div class="status"><span id="dot" class="dot muted"></span><span id="label" class="mutetext">idle</span></div>
        </div>
        <div class="section">
          <div class="results-meta-row">
            <div class="field">
              <label>Latency</label>
              <div id="latency" class="pill">–</div>
            </div>
            <div class="field">
              <label>HTTP</label>
              <div id="status" class="pill">–</div>
            </div>
            <div class="field">
              <label>Endpoint</label>
              <div id="ep" class="pill">–</div>
            </div>
          </div>
        </div>
        <div class="section">
          <h3 style="margin:0 0 8px">Output</h3>
          <div class="code-wrapper">
            <button class="copy-btn" data-target="out" title="Copy to clipboard">Copy</button>
            <pre><code id="out">{ /* run to see output */ }</code></pre>
          </div>
        </div>
        <div class="section">
          <h3 style="margin:0 0 8px">Request</h3>
          <div class="code-wrapper">
            <button class="copy-btn" data-target="req" title="Copy to clipboard">Copy</button>
            <pre><code id="req">{ /* request payload will appear here */ }</code></pre>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>© 2025 Neutryx Lab · University College London</footer>

  <script>
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>document.querySelectorAll(q);

    // Current active tab
    let activeTab = 'pv';

    // API URL field
    const apiUrl = $('#api-url');
    const btnTest = $('#btnTest');

    // Engine toggles (common)
    const engineToggles = {
      useJax: $('#use-jax'),
      useJit: $('#use-jit'),
      useAad: $('#use-aad')
    };

    // Field references by tab
    const pvFields = {
      type: $('#pv-type'),
      notional: $('#pv-notional'),
      fixedRate: $('#pv-fixed-rate'),
      payFreq: $('#pv-pay-freq'),
      maturity: $('#pv-maturity'),
      curve1m: $('#pv-curve-1m'),
      curve3m: $('#pv-curve-3m'),
      curve6m: $('#pv-curve-6m'),
      curve1y: $('#pv-curve-1y'),
      curve2y: $('#pv-curve-2y'),
      curve5y: $('#pv-curve-5y')
    };

    const riskFields = {
      type: $('#risk-type'),
      notional: $('#risk-notional'),
      fixedRate: $('#risk-fixed-rate'),
      payFreq: $('#risk-pay-freq'),
      maturity: $('#risk-maturity'),
      bumpBp: $('#risk-bump-bp'),
      curve1m: $('#risk-curve-1m'),
      curve3m: $('#risk-curve-3m'),
      curve6m: $('#risk-curve-6m'),
      curve1y: $('#risk-curve-1y'),
      curve2y: $('#risk-curve-2y'),
      curve5y: $('#risk-curve-5y')
    };

    const xvaFields = {
      type: $('#xva-type'),
      notional: $('#xva-notional'),
      fixedRate: $('#xva-fixed-rate'),
      payFreq: $('#xva-pay-freq'),
      maturity: $('#xva-maturity'),
      curve1m: $('#xva-curve-1m'),
      curve1y: $('#xva-curve-1y'),
      curve5y: $('#xva-curve-5y'),
      curve10y: $('#xva-curve-10y'),
      lgdCp: $('#xva-lgd-cp'),
      lgdOwn: $('#xva-lgd-own'),
      funding: $('#xva-funding'),
      coc: $('#xva-coc'),
      capFactor: $('#xva-cap-factor'),
      grid: $('#xva-grid'),
      hazCp1y: $('#xva-haz-cp-1y'),
      hazCp5y: $('#xva-haz-cp-5y'),
      hazCp10y: $('#xva-haz-cp-10y'),
      hazOwn1y: $('#xva-haz-own-1y'),
      hazOwn5y: $('#xva-haz-own-5y'),
      hazOwn10y: $('#xva-haz-own-10y')
    };

    const btnRun = $('#btnRun');
    const btnSample = $('#btnSample');
    const out = $('#out');
    const reqbox = $('#req');
    const dot = $('#dot');
    const label = $('#label');
    const latency = $('#latency');
    const http = $('#status');
    const epdisp = $('#ep');

    function setStatus(kind, text){
      dot.className = 'dot ' + (kind||'muted');
      label.textContent = text||'idle';
    }

    // Tab switching
    function switchTab(tabName){
      activeTab = tabName;

      // Update tab buttons
      $$('.tab').forEach(tab => {
        if(tab.getAttribute('data-tab') === tabName){
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });

      // Update tab content
      $$('.tab-content').forEach(content => {
        if(content.id === `${tabName}-content`){
          content.classList.add('active');
        } else {
          content.classList.remove('active');
        }
      });

      // Clear errors when switching tabs
      clearAllErrors();
      setStatus('muted', 'idle');

      // Update endpoint display
      const endpointMap = {pv: '/swap/price', risk: '/swap/risks', xva: '/swap/xva'};
      epdisp.textContent = endpointMap[tabName] || '–';
    }

    // Add tab click listeners
    $$('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.getAttribute('data-tab');
        switchTab(tabName);
      });
    });

    // Validation functions
    function showFieldError(fieldId, message){
      const fieldEl = $(`#field-${fieldId}`);
      if(fieldEl){
        fieldEl.classList.add('field-error');
        const errMsg = fieldEl.querySelector('.error-msg');
        if(errMsg) errMsg.textContent = message;
      }
    }

    function clearFieldError(fieldId){
      const fieldEl = $(`#field-${fieldId}`);
      if(fieldEl){
        fieldEl.classList.remove('field-error');
        const errMsg = fieldEl.querySelector('.error-msg');
        if(errMsg) errMsg.textContent = '';
      }
    }

    function clearAllErrors(){
      // Clear errors for all numeric input fields
      $$('input[type="number"]').forEach(input => {
        clearFieldError(input.id);
      });
    }

    function validateField(fieldId, value){
      // Handle notional fields (with commas)
      const val = fieldId.includes('notional') ? parseNotional(value) : parseFloat(value);

      if(isNaN(val)){
        showFieldError(fieldId, 'Must be a number');
        return false;
      }

      // Basic validation: positive for notional/maturity, 0-1 for rates/lgd
      if(fieldId.includes('notional') || fieldId.includes('maturity') || fieldId.includes('grid')){
        if(val <= 0){
          showFieldError(fieldId, 'Must be positive');
          return false;
        }
      }

      clearFieldError(fieldId);
      return true;
    }

    function validateAllFields(){
      let valid = true;
      clearAllErrors();

      // Validate all numeric inputs in the active tab
      const activeContent = $(`#${activeTab}-content`);
      if(activeContent){
        activeContent.querySelectorAll('input[type="number"]').forEach(input => {
          if(input.value && !validateField(input.id, input.value)){
            valid = false;
          }
        });
        // Also validate text inputs (notional)
        activeContent.querySelectorAll('input[type="text"]').forEach(input => {
          if(input.id.includes('notional') && input.value && !validateField(input.id, input.value)){
            valid = false;
          }
        });
      }

      // Additional validation: Maturity must be multiple of Pay Freq
      let fields = activeTab === 'pv' ? pvFields : (activeTab === 'risk' ? riskFields : xvaFields);
      if(fields.maturity && fields.payFreq){
        const maturity = parseFloat(fields.maturity.value);
        const payFreqMonths = parseInt(fields.payFreq.value);
        const maturityMonths = maturity * 12;

        if(maturityMonths % payFreqMonths !== 0){
          showFieldError(fields.maturity.id, `Maturity must be a multiple of payment frequency (${payFreqMonths} months)`);
          valid = false;
        }
      }

      return valid;
    }

    // Add blur event listeners for real-time validation
    $$('input[type="number"]').forEach(input => {
      input.addEventListener('blur', () => validateField(input.id, input.value));
      input.addEventListener('input', () => clearFieldError(input.id));
    });

    // Add formatting for Notional fields (text inputs with commas)
    $$('input[type="text"]').forEach(input => {
      if(input.id.includes('notional')){
        input.addEventListener('blur', () => {
          const num = parseNotional(input.value);
          if(!isNaN(num) && num > 0){
            input.value = formatNotional(num);
          }
        });
        input.addEventListener('focus', () => {
          // Remove commas on focus for easier editing
          input.value = input.value.replace(/,/g, '');
        });
      }
    });

    // Loading state management
    function setLoading(isLoading){
      btnRun.disabled = isLoading;
      btnSample.disabled = isLoading;

      if(isLoading){
        btnRun.innerHTML = '<span class="spinner"></span> Computing...';
      } else {
        btnRun.textContent = 'Run computation';
      }
    }

    // Helper: Convert percentage to decimal (2.4% → 0.024)
    function pctToDecimal(pct){
      return parseFloat(pct) / 100;
    }

    // Helper: Convert decimal to percentage (0.024 → 2.4)
    function decimalToPct(dec){
      return (parseFloat(dec) * 100).toFixed(2);
    }

    // Helper: Parse notional with comma support (10,000,000 → 10000000)
    function parseNotional(str){
      return parseFloat(str.replace(/,/g, ''));
    }

    // Helper: Format notional with commas (10000000 → 10,000,000)
    function formatNotional(num){
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    // Build curve object from fields
    function buildCurve(fields, tenors){
      const curve = {};
      tenors.forEach(tenor => {
        const fieldKey = `curve${tenor.replace(/[MY]/g, '').toLowerCase()}`;
        if(fields[fieldKey]){
          // Convert percentage to decimal
          curve[tenor] = pctToDecimal(fields[fieldKey].value);
        }
      });
      return curve;
    }

    // Build swap request object
    function buildSwapRequest(fields, includeCurve = true){
      const swap = {
        notional: parseNotional(fields.notional.value),
        fixed_rate: pctToDecimal(fields.fixedRate.value),
        maturity_years: parseFloat(fields.maturity.value),
        pay_freq_months: parseInt(fields.payFreq.value),
        pay_fixed: fields.type ? fields.type.value === 'true' : true
      };

      if(includeCurve){
        const tenors = ['1M', '3M', '6M', '1Y', '2Y', '5Y'];
        swap.curve = buildCurve(fields, tenors);
      }

      return swap;
    }

    // Build engine toggles object
    function buildEngineToggles(){
      return {
        use_jax: engineToggles.useJax.checked,
        use_jit: engineToggles.useJit.checked,
        use_aad: engineToggles.useAad.checked
      };
    }

    // Copy to clipboard function
    function copyToClipboard(text, button){
      navigator.clipboard.writeText(text).then(() => {
        button.textContent = '✓ Copied';
        button.classList.add('copied');
        setTimeout(() => {
          button.textContent = 'Copy';
          button.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        console.error('Copy failed:', err);
        button.textContent = 'Failed';
        setTimeout(() => button.textContent = 'Copy', 2000);
      });
    }

    // Add copy button event listeners
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        const targetEl = $(`#${targetId}`);
        if(targetEl) copyToClipboard(targetEl.textContent, btn);
      });
    });

    function sample(){
      clearAllErrors();

      // Helper: Random percentage rate (returns percentage value, not decimal)
      const randPctRate = () => (Math.random()*3 + 0.5).toFixed(1);
      const randMaturity = () => (Math.floor(Math.random()*8)+2).toFixed(1);

      if(activeTab === 'pv'){
        // Notional with comma formatting
        pvFields.notional.value = formatNotional((Math.floor(Math.random()*9)+1) * 10_000_000);
        // Fixed rate as percentage
        pvFields.fixedRate.value = (Math.random()*2 + 1.5).toFixed(1);
        pvFields.maturity.value = randMaturity();
        // Randomize curve (as percentage)
        pvFields.curve1m.value = randPctRate();
        pvFields.curve3m.value = (parseFloat(pvFields.curve1m.value) + 0.2).toFixed(1);
        pvFields.curve6m.value = (parseFloat(pvFields.curve3m.value) + 0.2).toFixed(1);
        pvFields.curve1y.value = (parseFloat(pvFields.curve6m.value) + 0.2).toFixed(1);
        pvFields.curve2y.value = (parseFloat(pvFields.curve1y.value) + 0.4).toFixed(1);
        pvFields.curve5y.value = (parseFloat(pvFields.curve2y.value) + 0.7).toFixed(1);
      } else if(activeTab === 'risk'){
        riskFields.notional.value = formatNotional((Math.floor(Math.random()*9)+1) * 10_000_000);
        riskFields.fixedRate.value = (Math.random()*2 + 1.5).toFixed(1);
        riskFields.maturity.value = randMaturity();
        riskFields.bumpBp.value = '1.0';
        // Randomize curve (as percentage)
        riskFields.curve1m.value = randPctRate();
        riskFields.curve3m.value = (parseFloat(riskFields.curve1m.value) + 0.2).toFixed(1);
        riskFields.curve6m.value = (parseFloat(riskFields.curve3m.value) + 0.2).toFixed(1);
        riskFields.curve1y.value = (parseFloat(riskFields.curve6m.value) + 0.2).toFixed(1);
        riskFields.curve2y.value = (parseFloat(riskFields.curve1y.value) + 0.4).toFixed(1);
        riskFields.curve5y.value = (parseFloat(riskFields.curve2y.value) + 0.7).toFixed(1);
      } else if(activeTab === 'xva'){
        xvaFields.notional.value = formatNotional((Math.floor(Math.random()*9)+1) * 10_000_000);
        xvaFields.fixedRate.value = (Math.random()*2 + 1.5).toFixed(1);
        xvaFields.maturity.value = (Math.floor(Math.random()*8)+3).toFixed(1);
        // XVA parameters as percentage
        xvaFields.lgdCp.value = (Math.random()*30 + 50).toFixed(0);
        xvaFields.lgdOwn.value = (Math.random()*30 + 50).toFixed(0);
        xvaFields.funding.value = (Math.random()*0.3 + 0.1).toFixed(1);
        xvaFields.coc.value = (Math.random()*5 + 8).toFixed(0);
        xvaFields.capFactor.value = (Math.random()*20 + 40).toFixed(0);
        // Curve as percentage
        xvaFields.curve1m.value = randPctRate();
        xvaFields.curve1y.value = (parseFloat(xvaFields.curve1m.value) + 0.6).toFixed(1);
        xvaFields.curve5y.value = (parseFloat(xvaFields.curve1y.value) + 1.1).toFixed(1);
        xvaFields.curve10y.value = (parseFloat(xvaFields.curve5y.value) + 0.4).toFixed(1);
        // Hazard curves as percentage
        xvaFields.hazCp1y.value = (Math.random()*0.5 + 0.8).toFixed(1);
        xvaFields.hazCp5y.value = (parseFloat(xvaFields.hazCp1y.value) + 0.2).toFixed(1);
        xvaFields.hazCp10y.value = (parseFloat(xvaFields.hazCp5y.value) + 0.3).toFixed(1);
        xvaFields.hazOwn1y.value = (Math.random()*0.4 + 0.6).toFixed(1);
        xvaFields.hazOwn5y.value = (parseFloat(xvaFields.hazOwn1y.value) + 0.2).toFixed(1);
        xvaFields.hazOwn10y.value = (parseFloat(xvaFields.hazOwn5y.value) + 0.2).toFixed(1);
      }
    }

    async function run(){
      // Validate inputs before running
      if(!validateAllFields()){
        setStatus('err', 'Invalid inputs');
        return;
      }
      const base = apiUrl.value.replace(/\/$/,'');

      // Determine endpoint based on active tab
      let endpoint;
      let requestBody = {};

      if(activeTab === 'pv'){
        endpoint = 'swap/price';
        requestBody = {
          swap: buildSwapRequest(pvFields, true),
          engine: buildEngineToggles()
        };
      } else if(activeTab === 'risk'){
        endpoint = 'swap/risks';
        requestBody = {
          swap: buildSwapRequest(riskFields, true),
          engine: buildEngineToggles(),
          bump_bp: parseFloat(riskFields.bumpBp.value)
        };
      } else if(activeTab === 'xva'){
        endpoint = 'swap/xva';
        const xvaSwap = buildSwapRequest(xvaFields, false);
        // Add XVA-specific curve (convert percentage to decimal)
        xvaSwap.curve = {
          '1M': pctToDecimal(xvaFields.curve1m.value),
          '1Y': pctToDecimal(xvaFields.curve1y.value),
          '5Y': pctToDecimal(xvaFields.curve5y.value),
          '10Y': pctToDecimal(xvaFields.curve10y.value)
        };

        requestBody = {
          swap: xvaSwap,
          xva: {
            lgd_cp: pctToDecimal(xvaFields.lgdCp.value),
            lgd_own: pctToDecimal(xvaFields.lgdOwn.value),
            hazard_cp_curve: {
              '1Y': pctToDecimal(xvaFields.hazCp1y.value),
              '5Y': pctToDecimal(xvaFields.hazCp5y.value),
              '10Y': pctToDecimal(xvaFields.hazCp10y.value)
            },
            hazard_own_curve: {
              '1Y': pctToDecimal(xvaFields.hazOwn1y.value),
              '5Y': pctToDecimal(xvaFields.hazOwn5y.value),
              '10Y': pctToDecimal(xvaFields.hazOwn10y.value)
            },
            funding_spread: pctToDecimal(xvaFields.funding.value),
            cost_of_capital: pctToDecimal(xvaFields.coc.value),
            capital_factor: pctToDecimal(xvaFields.capFactor.value),
            grid_months: parseInt(xvaFields.grid.value)
          },
          engine: buildEngineToggles()
        };
      }

      epdisp.textContent = '/' + endpoint;
      setStatus('warn','running…');
      setLoading(true);
      http.textContent = '—';
      latency.textContent = '—';

      const t0 = performance.now();

      try{
        const url = `${base}/${endpoint}`;
        reqbox.textContent = JSON.stringify(requestBody, null, 2);

        const res = await fetch(url, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(requestBody)
        });

        const txt = await res.text();
        const t1 = performance.now();
        http.textContent = res.status + ' ' + res.statusText;
        latency.textContent = Math.max(0, t1 - t0).toFixed(0) + ' ms';

        try{
          out.textContent = JSON.stringify(JSON.parse(txt), null, 2);
          out.parentElement.classList.add('fade-in');
        }
        catch{ out.textContent = txt; }

        if(res.ok){
          setStatus('ok', 'success');
        } else {
          setStatus('err', `HTTP ${res.status} error`);
          // Try to parse error message
          try{
            const errData = JSON.parse(txt);
            if(errData.error || errData.message || errData.detail){
              out.textContent = JSON.stringify(errData, null, 2);
            }
          }catch{}
        }
      }catch(e){
        const t1 = performance.now();
        latency.textContent = Math.max(0, t1 - t0).toFixed(0) + ' ms';
        http.textContent = 'Network error';

        let errorMsg = 'Network request failed. ';
        if(e.message.includes('Failed to fetch')){
          errorMsg += 'Check your internet connection or API URL.';
        } else {
          errorMsg += e.message;
        }
        out.textContent = errorMsg;
        setStatus('err','Network error');
      } finally {
        setLoading(false);
      }
    }

    // Test API connection
    async function testConnection(){
      const base = apiUrl.value.replace(/\/$/,'');
      setStatus('warn', 'testing…');
      btnTest.disabled = true;
      btnTest.innerHTML = '<span class="spinner"></span> Testing...';

      try{
        const res = await fetch(`${base}/`);
        const data = await res.json();

        if(res.ok && data.status === 'ok'){
          setStatus('ok', 'API connected');
          alert('✓ API connection successful!\n\n' + JSON.stringify(data, null, 2));
        } else {
          setStatus('err', 'API error');
          alert('✗ API returned unexpected response:\n\n' + JSON.stringify(data, null, 2));
        }
      }catch(e){
        setStatus('err', 'connection failed');
        alert('✗ Connection failed:\n\n' + e.message);
      }finally{
        btnTest.disabled = false;
        btnTest.textContent = 'Test Connection';
      }
    }

    btnRun.addEventListener('click', run);
    btnSample.addEventListener('click', sample);
    btnTest.addEventListener('click', testConnection);

    // Initialize endpoint display
    switchTab('pv');

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Enter or Ctrl+Enter to run
      if((e.key === 'Enter' && e.ctrlKey) || (e.key === 'Enter' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT')){
        e.preventDefault();
        if(!btnRun.disabled) run();
      }
      // Escape to clear errors
      if(e.key === 'Escape'){
        clearAllErrors();
        setStatus('muted', 'idle');
      }
    });
  </script>
</body>
</html>
